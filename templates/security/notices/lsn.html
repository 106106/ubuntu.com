{% extends "security/base_security.html" %}

{% block title %}{{ notice.id }}: {{ notice.title }} | Ubuntu security notices{% endblock %}

{% block content %}
<section class="p-strip--suru-topped">
  <div class="row">
    <div class="col-12">
	    <h1>{{ notice.id }}: {{ notice.title }}</h1>
      <p class="p-muted-heading">{{ notice.published.strftime("%d %B %Y") }}</p>
      <p>{{ notice.summary | safe }}</p>
      <h2>Releases</h2>
      <ul class="p-inline-list u-no-margin--bottom">
        {% for release in notice.releases %}
          <li class="p-inline-list__item">
            <a href="/security/notices?release={{ release.codename }}" class="p-button--tag">Ubuntu {{ release.version }} {{ release.support_tag }}</a>
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  {% if notice.package_descriptions %}
  <div class="row">
    <div class="col-12">
      <h2>Packages</h2>
      <ul class="p-list">
        {% for package_name, package_title in notice.package_descriptions.items() %}
          <li class="p-list__item"><a href="/security/cve?package={{ package_name }}">{{ package_name }}</a> - {{ package_title }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <div class="row">
    <div class="col-8">
      <h2>Details</h2>
      <p>{{ notice.details|safe }}</p>
    </div>
  </div>

  <div class="row">
    <div class="col-8">
      <h2>Checking update status</h2>
      <p>The problem can be corrected in these Livepatch versions:</p>
      <table>
        <thead>
          <th>Kernel type</th>
          {% for version in notice.instructions %}
            <th>{{ version }}</th>
          {% endfor %}
        </thead>
        <tbody>
          {% for instruction_package in notice.instruction_packages %}
            <tr>
              <td><strong>{{ instruction_package }}</strong></td>
              {% for version in notice.instructions %}
                {% if notice.instructions[version][instruction_package] %}
                  <td>{{ notice.instructions[version][instruction_package] }}</td>
                {% else %}
                  <td>&mdash;</td>
                {% endif %}
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <p>To check your kernel type and Livepatch version, enter this command:</p>
      <div class="p-code-copyable">
        <input class="p-code-copyable__input" value="canonical-livepatch status" readonly="readonly">
        <button class="p-code-copyable__action">Copy to clipboard</button>
      </div>
    </div>
  </div>

  {% if notice.release_packages %}
    <div class="row">
      <div class="col-8">
        <h2>Support Information</h2>
        <p>Kernels older than the levels listed below do not receive livepatch updates. If you are running a kernel version earlier than the one listed below, please upgrade your kernel as soon as possible.</p>
        {% for version in notice.release_packages.__reversed__() %}
          <h3 class="p-heading--five">Ubuntu {{ version }}</h3>
          <ul class="p-list">
            {% for package in notice.release_packages[version] %}
              <li class="p-list__item">
                {% if package.source_link %}
                  <a href="{{package.source_link}}">{{ package.name }}</a>
                {% else %}
                  {{ package.name }}
                {% endif %}
                -
                {% if package.version_link %}
                  <a href="{{package.version_link}}">{{ package.version }}</a>
                {% else%}
                  {{ package.version }}
                {% endif %}
                <div>
                  <small>
                    {% if package.pocket == "esm-infra" %}
                      Available with <a href="/advantage">UA Infra or UA Desktop</a>
                    {% endif %}
                    {% if package.pocket == "esm-apps" %}
                      Available with <a href="/advantage">UA Apps or UA Desktop</a>
                    {% endif %}
                  </small>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {% if notice.cves or notice.references %}
  <div class="row">
    <div class="col-8">
      <h2>References</h2>
      <ul class="p-list">
        {% if notice.cves %}
          {% for cve in notice.cves %}
            <li class="p-list__item"><a href="https://people.canonical.com/~ubuntu-security/cve/{{ cve.id }}">{{ cve.id }}</a></li>
          {% endfor %}
        {% endif %}

        {% if notice.references %}
          {% for reference in notice.references %}
            <li class="p-list__item"><a href="{{ reference }}">{{ reference }}</li>
          {% endfor %}
        {% endif %}
      </ul>
    </div>
  </div>
  {% endif %}
</section>

<script>
  /**
    Copies text given as a parameter to clipboard.
    @param {String} str The text value to copy.
  */
  function copyToClipboard(str) {
    // Crate an offscreen textarea to handle copying.
    var copyEl = document.createElement('textarea');
    copyEl.value = str;
    copyEl.setAttribute('readonly', '');
    copyEl.style.position = 'absolute';
    copyEl.style.left = '-9999px';
    document.body.appendChild(copyEl);

    // Check for any existing selection range.
    var selectedRange =
      document.getSelection().rangeCount > 0
        ? document.getSelection().getRangeAt(0)
        : false;

    // Select and copy textarea contents.
    // Copy command only works as a result of a user action (e.g. click events).
    copyEl.select();
    document.execCommand('copy');

    document.body.removeChild(copyEl);

    // Restore any previous selection
    if (selectedRange) {
      document.getSelection().removeAllRanges();
      document.getSelection().addRange(selectedRange);
    }
  }

  /**
    Attaches event listener to the copy button
    @param {HTMLElement} codeCopyable The code copyable container element.
  */
  function setupCodeCopyable(codeCopyable) {
    var copyButton = codeCopyable.querySelector('.p-code-copyable__action');

    copyButton.addEventListener('click', function() {
      var clipboardValue = this.previousSibling.previousSibling.value;
      copyToClipboard(clipboardValue);
    });
  }

  // Setup all code copyable blocks on the page.
  var codeCopyables = document.querySelectorAll('.p-code-copyable');

  for (var i = 0, l = codeCopyables.length; i < l; i++) {
    setupCodeCopyable(codeCopyables[i]);
  }
</script>

{% with first_item="_security_discussion", second_item="_security_esm", third_item="_security_further_reading" %}{% include "shared/contextual_footers/_contextual_footer.html" %}{% endwith %}

{% endblock %}
