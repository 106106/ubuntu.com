<div class="p-modal p-modal--ua-payment is-details-mode"id="purchase-modal" style="display: none;">
  <div class="p-modal__dialog" role="dialog" aria-labelledby="modal-title">
    <header class="p-modal__header">
      <h2 class="p-modal__title u-no-margin--bottom" id="modal-title">
        Complete purchase
      </h2>
    </header>
    <div id="modal-description" class="p-modal__body">
      <section id="summary-section" class="p-strip is-shallow u-no-padding--top">
        <div class="row u-no-padding u-sv1 ">
          <div class="col-3 u-text-light">Plan type:</div>
          <div class="col-9" id="plan-type"></div>  
        </div>
        <div class="row u-no-padding u-sv1 ">
          <div class="col-3 u-text-light">Machines:</div>
          <div class="col-9" id="allowance"></div>  
        </div>
        <div class="row u-no-padding u-sv1 ">
          <div class="col-3 u-text-light">Starts:</div>
          <div class="col-9" id="start-date"></div>  
        </div>
        <div class="row u-no-padding u-sv1 ">
          <div class="col-3 u-text-light">Ends:</div>
          <div class="col-9" id="end-date"></div>  
        </div>
        <div class="row u-no-padding u-sv1 ">
          <div class="col-3 u-text-light">Subtotal:</div>
          <div class="col-9" id="subtotal"></div>  
        </div>
      </section>

      <section class="p-strip is-shallow u-no-padding" style="overflow-x: visible;">
        <div id="payment-errors" class="p-notification--negative u-hide">
          <p class="p-notification__response">
            <span class="p-notification__message"></span>
          </p>
        </div>

        <form class="p-form p-form--stacked u-sv3" id="details-form">
          <div class="p-form__group  row u-no-padding" id="free-trial-section">
            <div class="col-3">
              <label for="free-trial"><strong>Free trial:</strong></label>
            </div>

            <div class="col-9">
              <p class="u-no-margin--bottom">Subscribe for 1 month free, no payment card needed</p>
            </div>
            <div class="col-start-large-4 col-9">
                <label class="p-radio--inline">
                  <input type="radio" class="p-radio__input" name="free_trial" aria-labelledby="use_free_trial" id="use_free_trial_input">
                  <span class="p-radio__label" id="use_free_trial">Use free trial month</span>
                </label>

                <label class="p-radio--inline">
                  <input type="radio" class="p-radio__input" name="free_trial" aria-labelledby="pay_now" id="pay_now_input">
                  <span class="p-radio__label" id="pay_now">Pay now</span>
                </label>
            </div>
          </div>

          <div class="p-form__group row u-no-padding u-vertically-center" id="credit-card-section">
            <div class="col-3">
              <label class="u-no-padding--top">Payment card:</label>
            </div>

            <div class="col-9">
              <div id="card-element"></div>
            </div>

            <div class="col-9 col-start-large-4">
              <span id="card-errors" class="p-form-validation__message u-hide"></span>
            </div>
          </div>

          <div class="p-form__group p-form-validation row u-no-padding u-vertically-center">
            <div class="col-3">
              <label class="u-no-padding--top" for="email">Email my receipt to:</label>
            </div>

            <div class="col-9">
              <input class="p-form-validation__input" name="email" type="email" required value="{{ user_info.email }}" />
            </div>

            <div class="col-9 col-start-large-4">
              <span class="p-form-validation__message u-hide"></span>
            </div>

            <div class="col-9 col-start-large-4">
              <small>We'll also send setup instructions to this address.</small>
            </div>
          </div>

          <div class="p-form__group p-form-validation row u-no-padding u-vertically-center">
            <div class="col-3">
              <label class="u-no-padding--top" for="customer_name">My name:</label>
            </div>

            <div class="col-9">
              <input class="p-form-validation__input" name="name" type="text" required value="{{ user_info.fullname }}" />
            </div>

            <div class="col-9 col-start-large-4">
              <span class="p-form-validation__message u-hide"></span>
            </div>
          </div>

          {% if account is defined %}
            <div class="p-form__group row u-no-padding u-vertically-center">
              <div class="col-3">
                <label class="u-no-padding--top" for="customer_name">I'm buying for:</label>
              </div>
              <div class="col-9">
                  <label class="p-radio--inline">
                    <input type="radio" class="p-radio__input" name="buying_for" id="buying_for_myself" {% if not account %}checked=""{% endif %} aria-labelledby="Myself">
                    <span class="p-radio__label" id="Myself">Myself</span>
                  </label>

                  <label class="p-radio--inline">
                    <input type="radio" class="p-radio__input" name="buying_for" id="buying_for_an_organisation" aria-labelledby="organisation" checked="true">
                    <span class="p-radio__label" id="organisation">An organisation</span>
                  </label>
              </div>
            </div>
            <div id="organisation-section" class="p-form-validation p-form__group row u-no-padding u-vertically-center">
              <div class="col-3">
                <label class="u-no-padding--top" for="account_name" >Organisation:</label>
              </div>

              <div class="col-9">
                <input class="p-form-validation__input" name="organisation" id="account_name" type="text" value="{{ account.name }}" />
              </div>

              <div class="col-9 col-start-large-4">
                <span class="p-form-validation__message u-hide"></span>
              </div>
            </div>
          {% endif %}

          <div class="p-form__group p-form-validation row u-no-padding">
            <div class="col-3">
              <label for="address">Address:</label>
            </div>

            <div class="col-9">
              <input class="p-form-validation__input" name="street" type="text" autocomplete="address" required />
            </div>

            <div class="col-9 col-start-large-4">
              <span class="p-form-validation__message u-hide"></span>
            </div>
          </div>

          <div class="p-form__group p-form-validation row u-no-padding">
            <div class="col-3">
              <label for="city">City:</label>
            </div>

            <div class="col-9">
              <input class="p-form-validation__input" type="text" name="city" autocomplete="city" required />
            </div>

            <div class="col-9 col-start-large-4">
              <span class="p-form-validation__message u-hide"></span>
            </div>
          </div>

          <div class="p-form-validation p-form__group row u-no-padding u-vertically-center">
            <div class="col-3">
              <label class="u-no-padding--top" >Country/Region:</label>
            </div>

            <div class="col-9">
              {% with raw="true" %} 
                {% include "shared/forms/_country.html" %}
              {% endwith %}
            </div>

            <div class="col-9 col-start-large-4">
              <span class="p-form-validation__message u-hide"></span>
            </div>
          </div>

          <div class="p-form__group p-form-validation row u-no-padding">
            <div class="col-3">
              <label for="postal_code">Postal code:</label>
            </div>

            <div class="col-9">
              <input class="p-form-validation__input" type="text" name="postalCode" autocomplete="postal_code" required />
            </div>

            <div class="col-9 col-start-large-4">
              <span class="p-form-validation__message u-hide"></span>
            </div>
          </div>

          <div id="us-states-container" class="p-form__group p-form-validation row u-no-padding u-vertically-center u-hide">
            <div class="col-3">
              <label class="u-no-padding--top" for="us_state">State:</label>
            </div>

            <div class="col-9">
              {% include "shared/forms/_us_states.html" %}
            </div>

            <div class="col-9 col-start-large-4">
              <span class="p-form-validation__message u-hide"></span>
            </div>
          </div>

          <div id="ca-provinces-container" class="p-form__group p-form-validation row u-no-padding u-vertically-center u-hide">
            <div class="col-3">
              <label class="u-no-padding--top" for="ca_province">Province:</label>
            </div>

            <div class="col-9">
              {% include "shared/forms/_ca_provinces.html" %}
            </div>

            <div class="col-9 col-start-large-4">
              <span class="p-form-validation__message u-hide"></span>
            </div>
          </div>

          <div id="vat-container" class="p-form__group p-form-validation row u-no-padding u-vertically-center u-hide">
            <div class="col-3">
              <label class="u-no-padding--top" >VAT number:</label>
            </div>

            <div class="col-7">
              <input class="p-form-validation__input" name="VATNumber" type="text" />
            </div>

            <div class="col-2">
              (if required)
            </div>

            <div class="col-9 col-start-large-4">
              <span class="p-form-validation__message u-hide"></span>
            </div>

            <div class="col-9 col-start-large-4">
              <small>e.g. GB 123 1234 12 123 or GB 123 4567 89 1234</small>
            </div>
          </div>
        </form>

        <div id="vat-summary-section" class="row u-no-padding u-sv1">
          <div class="col-3 u-text-light">VAT:</div>
          <div class="col-9" id="vat"></div>  
        </div>
        <div class="row u-no-padding u-sv1 ">
          <div class="col-3 u-text-light">Total:</div>
          <div class="col-9" id="total"></div>  
          <p class="col-9 col-start-large-4" id="excluding-vat"><small>Excluding VAT</small></p>  
        </div>

        <section id="free-trial-terms-section" class="p-strip is-shallow u-no-padding--top">
        <div class="row u-no-padding">
          <div class="col-9 col-start-large-4">
              <input type="checkbox" id="free-trial-terms">
              <label class="u-float-left" for="free-trial-terms">
                I agree that my subscription is subject to the <a href="/legal/ubuntu-advantage-service-terms" target="_blank" rel="noopener noreferrer">UA Essential Terms of Service</a>, <a href="/legal/data-privacy/online-purchase" target="_blank" rel="noopener noreferrer">privacy notice</a> and <a href="/legal/data-privacy" target="_blank" rel="noopener noreferrer">privacy policy</a>.
              </label>
          </div>
        </div>
      </section>

        <div id="order-summary">
          <div class="row u-no-padding">
            <div class="col-3">
              <p class="u-text-light">Receipt will be sent to:</p>
            </div>

            <div class="col-9">
              <p class="js-customer-email"></p>
            </div>
          </div>

          <div class="row u-no-padding">
            <div class="col-6 u-vertically-center">
              <p class="u-text-light">Payment method:</p>
            </div>

            <div class="col-6 u-align--right">
              <button class="p-button js-change-payment-method">
                Change...
              </button>
            </div>
          </div>

          <div class="p-card">
            <div class="row u-no-padding">
              <div class="col-2 col-small-1 js-customer-card-brand u-hide col-small-2"></div>
              <div class="col-8 col-small-3">
                <span class="js-customer-name"></span><br />
                <span class="js-customer-card"></span>
              </div>
              <div class="col-2 col-small-3 col-start-small-2">
                <span class="u-text-light">Expires:</span><br />
                <span class="js-customer-card-expiry"></span>
              </div>
            </div>
          </div>
        </div>

        <div id="payment-error-dialog">
          <p></p>
        </div>
      </section>

      <section id="order-terms" class="p-strip is-shallow u-no-padding--top">
        <div class="row u-no-padding">
          <div class="col-12">
            <form>
              <input type="checkbox" id="renewal-terms" checked="" class="js-terms">
              <label class="u-float-left" for="renewal-terms">I agree to the <a href="/legal/ubuntu-advantage-service-terms" target="_blank" rel="noopener noreferrer">Ubuntu Advantage service terms</a></label>
            </form>
          </div>
        </div>
      </section>

      <div id="order-processing" class="u-align--center">
        <i class="p-icon--spinner u-animation--spin"></i>
      </div>
    </div>

    <footer class="p-modal__footer">
      <span id="js-progress-indicator" class="p-modal__progress u-hide">
        <i class="p-icon--success u-hide"></i>
        <i class="p-icon--spinner u-animation--spin"></i>&nbsp;&nbsp;
        <span></span>
      </span>

      <div class="row u-no-padding">
        <button class="js-cancel-modal col-small-2 col-medium-2 col-start-medium-3 col-start-large-7 col-3 u-no-margin" style="text-align: center;" aria-controls="purchase-modal">
          Cancel
        </button>

        <button id="continue-button" class="col-small-2 col-medium-2 col-3 p-button--positive u-no-margin" style="text-align: center;" disabled type="submit">
          Continue
        </button>

        <button class="js-process-payment col-small-2 col-medium-2 col-3 p-button--positive u-no-margin" style="text-align: center;" disabled type="submit">
          Pay
        </button>

        <button class="js-close-modal col-small-2 col-medium-2 col-3 p-button" style="text-align: center;">OK</button>
      </div>
    </footer>
  </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
  window.stripePublishableKey = "{{ stripe_publishable_key }}";
</script>

